<div class="page">
    <div class="header">
        <h2>Users</h2>

        <div class="meta">
             <span class="selected-count">Selected: {{ selectedCount }}</span>
        </div>
    </div>
    @if (message) {
        <div class="message">{{ message }}</div>
    }

    <div class ="toolbar">
        <button type="button" (click)="logout()" [disabled]="busy">Logout</button>
        <button type="button" (click)="refresh()" [disabled]="busy ">Refresh</button>
        <button type="button" (click)="blockSelected()" [disabled]="busy || selectedCount === 0">Block</button>
        <button type="button" (click)="unblockSelected()" [disabled]="busy || selectedCount === 0">Unblock</button>
        <button type="button" (click)="deleteSelected()" [disabled]="busy || selectedCount === 0">Delete</button>
        <button type="button" (click)="deleteUnverified()" [disabled]="busy || selectedCount === 0">Delete Unverified</button>       
    </div>
    
    <div class="tableWrap">
    <table class="table">
        <thead>
            <tr>
                <th class="checkCol">
                    <input
                    #allBox
                    type="checkbox"
                    [checked]="list.length > 0 && selectedCount === list.length"
                    (change)="toggleAll(allBox.checked)"
                    [disabled]="busy || list.length === 0"
                    aria-label="Select all"
                    />
                </th>
            <th>Name</th>
            <th>Email</th>
            <th>Status</th>
            <th>Created</th>
            <th>Last Login</th>
            </tr>
        </thead>
       
    <tbody>
         @for (u of list ; track u.id) {
            <tr>
                <td class="checkCol">
                    <input
                    #rowBox
                    type="checkbox"
                    [checked]="isSelected(u.id)"
                    (change)="toggleOne(u.id, rowBox.checked)"
                    [disabled]="busy"
                    aria-label="Select user"
                    />
                </td>
                <td>{{ u.name }}</td>
                <td>{{ u.email }}</td>
                <td>{{ u.status }}</td>
                <td>{{ u.createdAtUtc }}</td>
                <td>{{ u.lastLoginAtUtc || '-' }}</td>
            </tr>
         }     
         
         @if (list.length === 0) {
            <tr>
                <td class="empty" colspan="6">No users found.</td>
            </tr>
        }                                     
        </tbody>
    </table>
    </div>
</div>