<div class="page">
  <div class="container">
    <div class="toolbar">
      <div class="toolbar-left">
        <button class="btn" type="button" (click)="refresh()" [disabled]="busy">Refresh</button>
        <button class="btn" type="button" (click)="blockSelected()" [disabled]="busy || selectedCount === 0">Block</button>
        <button class="btn" type="button" (click)="unblockSelected()" [disabled]="busy || selectedCount === 0">Unblock</button>
        <button class="btn btn-danger" type="button" (click)="deleteSelected()" [disabled]="busy || selectedCount === 0">Delete</button>
        <button class="btn btn-danger" type="button" (click)="deleteUnverified()" [disabled]="busy">Delete Unverified</button>
      </div>

      <div class="helper" style="margin:0;">
        Selected: {{ selectedCount }}
      </div>
    </div>

    @if (message) {
      <div class="alert">{{ message }}</div>
    }

    <div class="tableWrap">
    <table class="table">
        <thead>
            <tr>
                <th class="checkCol">
                    <input
                    #allBox
                    type="checkbox"
                    [checked]="list.length > 0 && selectedCount === list.length"
                    (change)="toggleAll(allBox.checked)"
                    [disabled]="busy || list.length === 0"
                    aria-label="Select all"
                    />
                </th>
            <th>Name</th>
            <th>Email</th>
            <th>Status</th>
            <th>Created</th>
            <th>Last Login</th>
            </tr>
        </thead>
       
    <tbody>
         @for (u of list ; track u.id) {
            <tr>
                <td class="checkCol">
                    <input
                    #rowBox
                    type="checkbox"
                    [checked]="isSelected(u.id)"
                    (change)="toggleOne(u.id, rowBox.checked)"
                    [disabled]="busy"
                    aria-label="Select user"
                    />
                </td>
                <td>{{ u.name }}</td>
                <td>{{ u.email }}</td>
                <td>
                    <span class="badge"
                    [class.badge-active]="u.status === 'Active'"
                    [class.badge-blocked]="u.status === 'Blocked'"
                    [class.badge-unverified]="u.status === 'Unverified'">
                    {{ u.status }}
                    </span>
                </td>

                <td>{{ u.createdAtUtc | date: 'dd.MM.yyyy HH:mm' }}</td>
                <td>
                    @if (u.lastLoginAtUtc) {
                        {{ u.lastLoginAtUtc | date: 'dd.MM.yyyy HH:mm' }}
                    } @else {
                        -
                    }
                </td>
            </tr>
         }     
         
         @if (list.length === 0) {
            <tr>
                <td class="empty" colspan="6">No users found.</td>
            </tr>
        }                                     
        </tbody>
    </table>
    </div>
  </div>
</div>